<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Panel Multifirma - Demo</title>
  <style>
    body {
      font-family: Inter, system-ui, Arial;
      margin: 20px;
      background: #fafafa;
    }
    .pr {
      border: 1px solid #ddd;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .green { background: #e6ffed; }
    .yellow { background: #fffbe6; }
    .red { background: #ffe6e6; }
    .meta { font-size: 0.9em; color: #555; }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 600;
      margin-right: 6px;
      background: #eee;
    }
    button {
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.9em;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h2>üö¶ Panel multifirma ‚Äî Demo r√°pida</h2>
  <div>Repositorio: <strong id="repoLabel"></strong></div>
  <div id="container"></div>

<script>
const owner = "04anamaria";    // <-- tu usuario de GitHub
const repo  = "netmon";        // <-- tu repositorio
document.getElementById('repoLabel').innerText = `${owner}/${repo}`;

function storageKey(prNumber){ 
  return `netmon_sim_approvals_${owner}_${repo}_${prNumber}`; 
}

async function api(path){
  const url = `https://api.github.com/repos/${owner}/${repo}${path}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error(await res.text());
  return res.json();
}

function stateClass(s){ 
  return s==="green"?"green": s==="yellow"?"yellow":"red"; 
}

function getSimApprovals(prNumber){
  const v = localStorage.getItem(storageKey(prNumber));
  return v ? Number(v) : null;
}
function addSimApproval(prNumber){
  const cur = getSimApprovals(prNumber) ?? 0;
  localStorage.setItem(storageKey(prNumber), String(cur + 1));
  build();
}
function resetSimApprovals(prNumber){
  localStorage.removeItem(storageKey(prNumber));
  build();
}

async function build(){
  const prs = await api('/pulls?state=open');
  const cont = document.getElementById('container');
  cont.innerHTML = '';
  for(const pr of prs){
    const commits = await fetch(pr.commits_url).then(r=>r.json());
    const reviews = await fetch(pr.url + '/reviews').then(r=>r.json());
    const signed = commits.length>0 && commits.every(c => c.commit && c.commit.verification && c.commit.verification.verified === true);
    const approvers = new Set(reviews.filter(r=>r.state==="APPROVED").map(r=>r.user.login));
    let approvals = approvers.size;

    const sim = getSimApprovals(pr.number);
    if(sim !== null) approvals = approvals + sim;

    let sast = "pending";
    try {
      const checks = await fetch(`https://api.github.com/repos/${owner}/${repo}/commits/${pr.head.sha}/check-suites`).then(r=>r.json());
      if(checks.total_count && checks.total_count>0) sast = "success";
    } catch(e){}

    let state = "red";
    if(!signed || sast==="failure") state="red";
    else if(signed && approvals<2) state="yellow";
    else if(signed && approvals>=2 && sast==="success") state="green";

    const div = document.createElement('div');
    div.className = 'pr ' + stateClass(state);
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>PR #${pr.number} ‚Äî ${pr.title}</strong>
          <div class="meta">Autor: ${pr.user.login} ‚Ä¢ SHA: ${pr.head.sha.slice(0,7)}</div>
        </div>
        <div style="text-align:right">
          <div class="badge">${signed? '‚úÖ Firmado':'‚ùå Sin firma'}</div>
          <div class="badge">üë• ${approvals}/2 aprobaciones</div>
          <div class="badge">SAST: ${sast}</div>
        </div>
      </div>
      <div style="margin-top:8px">${pr.body? pr.body.slice(0,220):''}</div>
      <div style="margin-top:8px">
        <button onclick="addSimApproval(${pr.number})">+1 aprobaci√≥n (simular)</button>
        <button onclick="resetSimApprovals(${pr.number})" style="margin-left:8px;background:#888">Reset simulaci√≥n</button>
      </div>
    `;
    cont.appendChild(div);
  }
}

build().catch(err=>{
  document.getElementById('container').innerText = 'Error: '+err.message;
});
</script>
</body>
</html>
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Panel Multifirma - Demo</title>
  <style>
    body {
      font-family: Inter, system-ui, Arial;
      margin: 20px;
      background: #fafafa;
    }
    .pr {
      border: 1px solid #ddd;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .green { background: #e6ffed; }
    .yellow { background: #fffbe6; }
    .red { background: #ffe6e6; }
    .meta { font-size: 0.9em; color: #555; }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 600;
      margin-right: 6px;
      background: #eee;
    }
    button {
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.9em;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h2>üö¶ Panel multifirma ‚Äî Demo r√°pida</h2>
  <div>Repositorio: <strong id="repoLabel"></strong></div>
  <div id="container"></div>

<script>
const owner = "04anamaria";    // <-- tu usuario de GitHub
const repo  = "netmon";        // <-- tu repositorio
document.getElementById('repoLabel').innerText = `${owner}/${repo}`;

function storageKey(prNumber){ 
  return `netmon_sim_approvals_${owner}_${repo}_${prNumber}`; 
}

async function api(path){
  const url = `https://api.github.com/repos/${owner}/${repo}${path}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error(await res.text());
  return res.json();
}

function stateClass(s){ 
  return s==="green"?"green": s==="yellow"?"yellow":"red"; 
}

function getSimApprovals(prNumber){
  const v = localStorage.getItem(storageKey(prNumber));
  return v ? Number(v) : null;
}
function addSimApproval(prNumber){
  const cur = getSimApprovals(prNumber) ?? 0;
  localStorage.setItem(storageKey(prNumber), String(cur + 1));
  build();
}
function resetSimApprovals(prNumber){
  localStorage.removeItem(storageKey(prNumber));
  build();
}

async function build(){
  const prs = await api('/pulls?state=open');
  const cont = document.getElementById('container');
  cont.innerHTML = '';
  for(const pr of prs){
    const commits = await fetch(pr.commits_url).then(r=>r.json());
    const reviews = await fetch(pr.url + '/reviews').then(r=>r.json());
    const signed = commits.length>0 && commits.every(c => c.commit && c.commit.verification && c.commit.verification.verified === true);
    const approvers = new Set(reviews.filter(r=>r.state==="APPROVED").map(r=>r.user.login));
    let approvals = approvers.size;

    const sim = getSimApprovals(pr.number);
    if(sim !== null) approvals = approvals + sim;

    let sast = "pending";
    try {
      const checks = await fetch(`https://api.github.com/repos/${owner}/${repo}/commits/${pr.head.sha}/check-suites`).then(r=>r.json());
      if(checks.total_count && checks.total_count>0) sast = "success";
    } catch(e){}

    let state = "red";
    if(!signed || sast==="failure") state="red";
    else if(signed && approvals<2) state="yellow";
    else if(signed && approvals>=2 && sast==="success") state="green";

    const div = document.createElement('div');
    div.className = 'pr ' + stateClass(state);
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>PR #${pr.number} ‚Äî ${pr.title}</strong>
          <div class="meta">Autor: ${pr.user.login} ‚Ä¢ SHA: ${pr.head.sha.slice(0,7)}</div>
        </div>
        <div style="text-align:right">
          <div class="badge">${signed? '‚úÖ Firmado':'‚ùå Sin firma'}</div>
          <div class="badge">üë• ${approvals}/2 aprobaciones</div>
          <div class="badge">SAST: ${sast}</div>
        </div>
      </div>
      <div style="margin-top:8px">${pr.body? pr.body.slice(0,220):''}</div>
      <div style="margin-top:8px">
        <button onclick="addSimApproval(${pr.number})">+1 aprobaci√≥n (simular)</button>
        <button onclick="resetSimApprovals(${pr.number})" style="margin-left:8px;background:#888">Reset simulaci√≥n</button>
      </div>
    `;
    cont.appendChild(div);
  }
}

build().catch(err=>{
  document.getElementById('container').innerText = 'Error: '+err.message;
});
</script>
</body>
</html>
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Panel Multifirma - Demo</title>
  <style>
    body {
      font-family: Inter, system-ui, Arial;
      margin: 20px;
      background: #fafafa;
    }
    .pr {
      border: 1px solid #ddd;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .green { background: #e6ffed; }
    .yellow { background: #fffbe6; }
    .red { background: #ffe6e6; }
    .meta { font-size: 0.9em; color: #555; }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 600;
      margin-right: 6px;
      background: #eee;
    }
    button {
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.9em;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h2>üö¶ Panel multifirma ‚Äî Demo r√°pida</h2>
  <div>Repositorio: <strong id="repoLabel"></strong></div>
  <div id="container"></div>

<script>
const owner = "04anamaria";    // <-- tu usuario de GitHub
const repo  = "netmon";        // <-- tu repositorio
document.getElementById('repoLabel').innerText = `${owner}/${repo}`;

function storageKey(prNumber){ 
  return `netmon_sim_approvals_${owner}_${repo}_${prNumber}`; 
}

async function api(path){
  const url = `https://api.github.com/repos/${owner}/${repo}${path}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error(await res.text());
  return res.json();
}

function stateClass(s){ 
  return s==="green"?"green": s==="yellow"?"yellow":"red"; 
}

function getSimApprovals(prNumber){
  const v = localStorage.getItem(storageKey(prNumber));
  return v ? Number(v) : null;
}
function addSimApproval(prNumber){
  const cur = getSimApprovals(prNumber) ?? 0;
  localStorage.setItem(storageKey(prNumber), String(cur + 1));
  build();
}
function resetSimApprovals(prNumber){
  localStorage.removeItem(storageKey(prNumber));
  build();
}

async function build(){
  const prs = await api('/pulls?state=open');
  const cont = document.getElementById('container');
  cont.innerHTML = '';
  for(const pr of prs){
    const commits = await fetch(pr.commits_url).then(r=>r.json());
    const reviews = await fetch(pr.url + '/reviews').then(r=>r.json());
    const signed = commits.length>0 && commits.every(c => c.commit && c.commit.verification && c.commit.verification.verified === true);
    const approvers = new Set(reviews.filter(r=>r.state==="APPROVED").map(r=>r.user.login));
    let approvals = approvers.size;

    const sim = getSimApprovals(pr.number);
    if(sim !== null) approvals = approvals + sim;

    let sast = "pending";
    try {
      const checks = await fetch(`https://api.github.com/repos/${owner}/${repo}/commits/${pr.head.sha}/check-suites`).then(r=>r.json());
      if(checks.total_count && checks.total_count>0) sast = "success";
    } catch(e){}

    let state = "red";
    if(!signed || sast==="failure") state="red";
    else if(signed && approvals<2) state="yellow";
    else if(signed && approvals>=2 && sast==="success") state="green";

    const div = document.createElement('div');
    div.className = 'pr ' + stateClass(state);
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>PR #${pr.number} ‚Äî ${pr.title}</strong>
          <div class="meta">Autor: ${pr.user.login} ‚Ä¢ SHA: ${pr.head.sha.slice(0,7)}</div>
        </div>
        <div style="text-align:right">
          <div class="badge">${signed? '‚úÖ Firmado':'‚ùå Sin firma'}</div>
          <div class="badge">üë• ${approvals}/2 aprobaciones</div>
          <div class="badge">SAST: ${sast}</div>
        </div>
      </div>
      <div style="margin-top:8px">${pr.body? pr.body.slice(0,220):''}</div>
      <div style="margin-top:8px">
        <button onclick="addSimApproval(${pr.number})">+1 aprobaci√≥n (simular)</button>
        <button onclick="resetSimApprovals(${pr.number})" style="margin-left:8px;background:#888">Reset simulaci√≥n</button>
      </div>
    `;
    cont.appendChild(div);
  }
}

build().catch(err=>{
  document.getElementById('container').innerText = 'Error: '+err.message;
});
</script>
</body>
</html>
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Panel Multifirma - Demo</title>
  <style>
    body {
      font-family: Inter, system-ui, Arial;
      margin: 20px;
      background: #fafafa;
    }
    .pr {
      border: 1px solid #ddd;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .green { background: #e6ffed; }
    .yellow { background: #fffbe6; }
    .red { background: #ffe6e6; }
    .meta { font-size: 0.9em; color: #555; }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 600;
      margin-right: 6px;
      background: #eee;
    }
    button {
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.9em;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h2>üö¶ Panel multifirma ‚Äî Demo r√°pida</h2>
  <div>Repositorio: <strong id="repoLabel"></strong></div>
  <div id="container"></div>

<script>
const owner = "04anamaria";    // <-- tu usuario de GitHub
const repo  = "netmon";        // <-- tu repositorio
document.getElementById('repoLabel').innerText = `${owner}/${repo}`;

function storageKey(prNumber){ 
  return `netmon_sim_approvals_${owner}_${repo}_${prNumber}`; 
}

async function api(path){
  const url = `https://api.github.com/repos/${owner}/${repo}${path}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error(await res.text());
  return res.json();
}

function stateClass(s){ 
  return s==="green"?"green": s==="yellow"?"yellow":"red"; 
}

function getSimApprovals(prNumber){
  const v = localStorage.getItem(storageKey(prNumber));
  return v ? Number(v) : null;
}
function addSimApproval(prNumber){
  const cur = getSimApprovals(prNumber) ?? 0;
  localStorage.setItem(storageKey(prNumber), String(cur + 1));
  build();
}
function resetSimApprovals(prNumber){
  localStorage.removeItem(storageKey(prNumber));
  build();
}

async function build(){
  const prs = await api('/pulls?state=open');
  const cont = document.getElementById('container');
  cont.innerHTML = '';
  for(const pr of prs){
    const commits = await fetch(pr.commits_url).then(r=>r.json());
    const reviews = await fetch(pr.url + '/reviews').then(r=>r.json());
    const signed = commits.length>0 && commits.every(c => c.commit && c.commit.verification && c.commit.verification.verified === true);
    const approvers = new Set(reviews.filter(r=>r.state==="APPROVED").map(r=>r.user.login));
    let approvals = approvers.size;

    const sim = getSimApprovals(pr.number);
    if(sim !== null) approvals = approvals + sim;

    let sast = "pending";
    try {
      const checks = await fetch(`https://api.github.com/repos/${owner}/${repo}/commits/${pr.head.sha}/check-suites`).then(r=>r.json());
      if(checks.total_count && checks.total_count>0) sast = "success";
    } catch(e){}

    let state = "red";
    if(!signed || sast==="failure") state="red";
    else if(signed && approvals<2) state="yellow";
    else if(signed && approvals>=2 && sast==="success") state="green";

    const div = document.createElement('div');
    div.className = 'pr ' + stateClass(state);
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>PR #${pr.number} ‚Äî ${pr.title}</strong>
          <div class="meta">Autor: ${pr.user.login} ‚Ä¢ SHA: ${pr.head.sha.slice(0,7)}</div>
        </div>
        <div style="text-align:right">
          <div class="badge">${signed? '‚úÖ Firmado':'‚ùå Sin firma'}</div>
          <div class="badge">üë• ${approvals}/2 aprobaciones</div>
          <div class="badge">SAST: ${sast}</div>
        </div>
      </div>
      <div style="margin-top:8px">${pr.body? pr.body.slice(0,220):''}</div>
      <div style="margin-top:8px">
        <button onclick="addSimApproval(${pr.number})">+1 aprobaci√≥n (simular)</button>
        <button onclick="resetSimApprovals(${pr.number})" style="margin-left:8px;background:#888">Reset simulaci√≥n</button>
      </div>
    `;
    cont.appendChild(div);
  }
}

build().catch(err=>{
  document.getElementById('container').innerText = 'Error: '+err.message;
});
</script>
</body>
</html>
